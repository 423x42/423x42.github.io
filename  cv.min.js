String.prototype.normSpaces=function(){return this.replace(/\s{2,}/gi," ")};var cardValidator=function(){var n=[].indexOf,r=[{name:"amex",pattern:/^3[47]/,valid_length:[15],cvv_length:[4],gaps:[4,10]},{name:"diners_club_carte_blanche",pattern:/^30[0-5]/,valid_length:[14],cvv_length:[3],gaps:[4,10]},{name:"diners_club_international",pattern:/^3([689]|09)/,valid_length:[14],cvv_length:[3],gaps:[4,10]},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/,valid_length:[16],cvv_length:[3],gaps:[4,10]},{name:"laser",pattern:/^(6304|670[69]|6771)/,valid_length:[16,17,18,19],gaps:[4,8,12,16]},{name:"visa_electron",pattern:/^(4026|417500|4508|4844|491(3|7))/,valid_length:[16],cvv_length:[3],gaps:[4,8,12]},{name:"visa",pattern:/^4/,valid_length:[16],cvv_length:[3],gaps:[4,8,12]},{name:"mastercard",pattern:/^5[1-5]/,valid_length:[16],cvv_length:[3],gaps:[4,8,12]},{name:"maestro",pattern:/^(5018|5081|5044|5020|5038|603845|6304|6759|676[1-3]|6220|504834|504817|504645)\d*/,valid_length:[12,13,14,15,16,17,18,19],cvv_length:[0,3],gaps:[4,8,12,16]},{name:"rupay",range:[[508500,508999],[606985,607384],[607385,607484],[607485,607984],[608001,608100],[608101,608200],[608201,608300],[608301,608350],[608351,608500],[652150,652849],[652850,653049],[653050,653149],[817200,819899],[819900,820199]],valid_length:[16],cvv_length:[3],gaps:[4,8,12]},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,valid_length:[16],cvv_length:[3],gaps:[4,8,12]},{name:"sodexo",pattern:/^(637513)/,valid_length:[16],cvv_length:[3],gaps:[4,8,12]}],a=new Date;return function(t){function e(t){return this.card=function(t){var e,a;for(e=0,a=r.length;e<a;e++){if(r[e].hasOwnProperty("pattern")&&t.match(r[e].pattern))return r[e];if(r[e].hasOwnProperty("range")){var n=t.substr(0,6);if(isNaN(n))return null;n=Number.parseInt(n);for(var i=0;i<r[e].range.length;i++)if(r[e].range[i][0]<=n&&n<=r[e].range[i][1])return r[e]}}return null}(t),this.card&&this.cardType&&(this.cardType=this.card.name,this.luhnValid=function(t){var e,a,n,i,r,h;for(a=i=n=0,r=(h=t.split("").reverse()).length;i<r;a=++i)e=+(e=h[a]),n+=a%2?(e*=2)<10?e:e-9:e;return n%10==0}(t),this.lengthValid=function(t,e){var a;return a=t.length,0<=n.call(this.card.valid_length,a)}.call(this,t,this.card),this.valid=this.luhnValid&&this.lengthValid,this.cvvLength=this.card.cvv_length,this.gaps=this.card.gaps,this.supportedLengths=this.card.valid_length,this.maxLength=this.card.valid_length[this.card.valid_length.length-1]),{card_type:this.cardType,valid:this.luhnValid&&this.lengthValid,luhn_valid:this.luhnValid,length_valid:this.lengthValid,cvv_length:this.cvvLength,gaps:this.gaps,supported_lengths:this.supportedLengths,max_length:this.maxLength}}return this.cardNumber=t,this.card=null,this.cardType="unknown",this.valid=!1,this.luhnValid=!1,this.lengthValid=!1,this.cvvLength=[],this.gaps=[],this.supportedLengths=[],this.maxLength=null,this.month=1+a.getMonth(),this.year=+a.getFullYear(),this.getCardDetails=function(){if(!this.cardNumber)return null;var t=this.cardNumber.toString().replace(/[ -]/g,"");return e.call(this,t)},this.validateCard=function(){return!!this.cardNumber&&this.getCardDetails().valid},this.validateCvv=function(t){return t=t||"",!isNaN(t)&&(this.cardNumber?(this.card||this.validateCard(),this.cardType&&"maestro"==this.cardType?""==t||t&&0<=n.call(this.cvvLength,t.toString().length)||!1:!!t&&0<=n.call(this.cvvLength,t.toString().length)):2<t.length)},this.validateExpiry=function(t,e){return e=(""+e).noSpaces(),t=(""+t).noSpaces(),e=e.replace(/^(\d\d)$/,"20$1"),!(!/^\d{1,2}$/.test(t)||!/^\d{4}$/.test(e))&&!(!function(t,e,a){t--;var n=new Date(a,t,e);return n.getFullYear()==a&&n.getMonth()==t&&n.getDate()==e}(t,1,e)||this.year>+e||this.year===+e&&+t<this.month)},this.validateCard(),this}}();